!function(){function b(){var b=localStorage.getItem("prometheus_user_omnipointment");return b||(window.location=a),b}function i(a){for(var b=[],c=0;c<a.length;c++)b.indexOf(a[c])<0&&b.push(a[c]);return b}function n(a){var b=!1;return"My Meetings"===a||"Omnipointment"===a?b=!1:0===a.indexOf("Edit")?b=a.substr(5):0===a.indexOf("Respond to")?b=a.substr(11):0===a.indexOf("Team Ratings")&&(b=a.substr(13)),b}function o(){return new Promise((a,b)=>{var c=Date.now()-2*m;var d=Date.now();var f=e.ref("prometheus/visits/"+J+"/");var g=f.orderByChild("meta/datetime/timestamp").startAt(c).endAt(d);g.once("value",b=>{var c=b.val()||{};var d=Object.keys(c).map(a=>c[a]);var e={};d.forEach(a=>{var b=a.visit.mid;b&&(name=n(a.meta.page.title),"false"!==name&&(e[b]=name))});var f=d.filter(a=>{var b=a.visit.mid;"sample"===b&&(b=!1);return b}).map(a=>a.visit.mid);var g=i(f);var h=g.map(a=>({mid:a,name:e[a]||"Untitled Meeting"}));a(h)}).catch(b)})}function p(a,b,c){var d=c||{};a.innerText="",b.forEach(b=>{if(!(b.mid in d)){var c=document.createElement("div"),e=document.createElement("div");e.innerText=b.name;var f=document.createElement("button");f.innerText="Yes",f.dataset.mid=b.mid,f.dataset.meeting_name=b.name,f.addEventListener("click",a=>{var b=a.target.dataset.mid;var c=a.target.dataset.meeting_name;y(N,b,{name:c}).then(b=>{a.target.parentNode.style.display="none"})}),e.classList.add("div--inline"),f.classList.add("btn","btn--inline","btn--ghost"),c.appendChild(f),c.appendChild(e),a.appendChild(c)}})}function q(a,b){a.innerText="",b.forEach(b=>{var c=document.createElement("div");var d=document.createElement("div");d.innerText=b.name;var e=document.createElement("button");e.innerText="Go";e.dataset.tid=b.tid;e.addEventListener("click",a=>{var b=a.target.dataset.tid;G(b)});d.classList.add("div--inline");e.classList.add("btn","btn--inline","btn--ghost");c.appendChild(e);c.appendChild(d);a.appendChild(c)})}function r(a,b){for(var c=document.getElementsByClassName(a),d=0;d<c.length;d++){c[d].innerText=b}}function s(a){return new Promise((b,c)=>{if(a){var d={};d[J]=!0;var e={name:a,owner:J,members:d};h.ref("omniteams/teams").push(e).then(a=>{e.tid=a.path.o[2];b(e)}).catch(c)}else c("No team name given.")})}function t(){return new Promise((a,b)=>{var c=h.ref("omniteams/teams");var d=c.orderByChild("members/"+J).startAt(!0).endAt(!0);d.once("value",b=>{var c=b.val()||{};var d=Object.keys(c).map(a=>{var b=c[a];b.tid=a;return b});a(d)}).catch(b)})}function u(a){return new Promise((b,c)=>{if(a){var d=h.ref("omniteams/teams/"+a);d.once("value",a=>{var c=a.val();b(c)}).catch(c)}else c("No team id given.")})}function v(a){return new Promise((b,c)=>{if(a){var d=e.ref("prometheus/users/"+a+"/profile");d.once("value",a=>{var c=a.val();b(c)}).catch(c)}else c("No user id given.")})}function w(){for(var a=document.getElementsByClassName("container-closer"),b=0;b<a.length;b++)closer=a[b],closer.addEventListener("click",a=>{var b=a.target.parentNode;b&&(b.style.display="none")})}function x(a){a=a.split("+").join(" ");for(var c,b={},d=/[?&]?([^=]+)=([^&]*)/g;c=d.exec(a);)b[decodeURIComponent(c[1])]=decodeURIComponent(c[2]);return b}function y(a,b,c){var d=c||{name:!1};return new Promise((c,e)=>{var f=h.ref("omniteams/teams/"+a+"/meetings/"+b);f.set(d).then(a=>{c(!0)}).catch(e)})}function z(a,b){return new Promise((c,d)=>{var e=h.ref("omniteams/teams/"+a+"/members/"+b);e.set(!0).then(c).catch(d)})}function A(){t().then(a=>{var b=document.getElementById("team-choices-container");b.style.display="block";var c=document.getElementById("team-choices");q(c,a);var d=document.createElement("button");d.innerText="Create New Team";d.addEventListener("click",a=>{vex.dialog.prompt({message:"Team Name",callback:a=>{s(a).then(a=>{G(a.tid)})}})});d.classList.add("btn","btn--block","btn--primary");c.appendChild(d)}),v(J).then(a=>{var b=document.getElementById("user-holder");var c=document.createElement("div");c.classList.add("member");var d=document.createElement("div");d.style.background='url("'+a.picture+'")';var e=document.createElement("div");e.innerText="Welcome, "+a.name+".";c.appendChild(d);c.appendChild(e);b.appendChild(c)})}function B(a,b){a.innerHTML="";var c=[];b.forEach(a=>{var b=v(a);c.push(b)}),Promise.all(c).then(b=>{var c=document.createElement("p");c.innerText="Invite other teammates by sending them ";var d=document.createElement("a");d.innerText="this link.";d.classList.add("copy-link");c.appendChild(d);a.appendChild(c);b.forEach(b=>{var c=document.createElement("div");c.classList.add("member");var d=document.createElement("div");d.style.background='url("'+b.picture+'")';var e=document.createElement("div");e.innerText=b.name;c.appendChild(d);c.appendChild(e);a.appendChild(c)})})}function C(a,b){a.innerHTML="";for(var c in b){var d=b[c],e=document.createElement("div"),f=document.createElement("a");f.href="https://www.omnipointment.com/meeting/"+c+"?rdr=false",f.target="_blank",f.innerText=d.name||"Untitled Meeting",f.classList.add("btn","btn--block","btn--ghost"),e.appendChild(f),a.appendChild(e)}var g=document.createElement("a");g.href="https://www.omnipointment.com/meeting/create",g.target="_blank",g.innerText="Organize New Meeting",g.classList.add("btn","btn--block","btn--primary"),a.appendChild(g)}function D(a,b,c){a.innerHTML="";var d=document.createElement("ul"),e=b||{};0===Object.keys(e).length&&(e.sample={text:"Pin important URLs or team goals for all team members to see."});for(var f in e){var g=e[f],h=document.createElement("li");if(g.url){var i=document.createElement("a");i.href=g.url,i.target="_blank",i.innerText=g.text,h.appendChild(i)}else{var j=document.createElement("span");j.innerText=g.text,h.appendChild(j)}if(J===c.owner){var k=document.createElement("span");k.classList.add("pin-remover"),k.dataset.pid=f,k.innerText="x",k.addEventListener("click",a=>{var b=a.target.dataset.pid;F(N,b)}),h.appendChild(k)}d.appendChild(h)}a.appendChild(d);var l=document.createElement("button");l.innerText="Add Pinned Item",l.classList.add("btn","btn--block","btn--ghost"),l.addEventListener("click",a=>{vex.dialog.prompt({message:"What would you like to pin?",placeholder:"Try a URL or new team goal.",callback:a=>{a.indexOf("http")>-1?vex.dialog.prompt({message:"Link Title",callback:b=>{b?E(N,{text:b,url:a}):E(N,{text:a})}}):E(N,{text:a})}})}),a.appendChild(l)}function E(a,b){h.ref("omniteams/teams/"+a+"/pins").push(b)}function F(a,b){h.ref("omniteams/teams/"+a+"/pins/"+b).remove()}function G(a){if(a)if(L.team!==a){var b=window.location.origin+"/?team="+a;window.location=b}else{N=a;var c=document.getElementById("team-choices-container");c.style.display="none";var d=document.getElementById("team-container");d.style.display="block",H()}else A()}function H(){u(N).then(a=>{J in a.members||(document.getElementById("page").style.opacity=.25,vex.dialog.confirm({message:"Are you a member of "+a.name+"?",callback:a=>{a?z(N,J).then(a=>{window.location.reload()}):window.location="https://www.omnipointment.com"}}));r("fill-team",a.name);o().then(b=>{var c=document.getElementById("recent-meetings-container");c.style.display="block";var d=document.createElement("div");var e=a.meetings;p(d,b,e);c.appendChild(d)})}),h.ref("omniteams/teams/"+N).on("value",a=>{var b=a.val();var c=document.getElementById("pins-container");D(c,b.pins,b);var d=document.getElementById("members-container");var e=Object.keys(b.members).sort((a,c)=>{var d=b.owner===a?1:0;var e=b.owner===c?1:0;return e-d});B(d,e);var f=document.getElementById("meetings-container");C(f,b.meetings)}),new Clipboard(".copy-link",{text:a=>window.location.href}).on("success",a=>{vex.dialog.prompt({message:"Link copied. Now, it share with your teammates!",value:window.location.href,callback:a=>{}})}),w()}var a="https://www.omnipointment.com/login?u=https://omnipointment.github.io",c={apiKey:"AIzaSyDzqDG7BigYHeePB5U74VgVWlIRgjEyV3s",authDomain:"omnipointment.firebaseapp.com",databaseURL:"https://omnipointment.firebaseio.com",storageBucket:"project-1919171548079707132.appspot.com",noScreenshots:!0,localhost:!1},d=firebase.initializeApp(c,"Omni Firebase"),e=d.database(),f={apiKey:"AIzaSyD1KVVGuoOsINY1l1DrZDKS8T3qN7Rp1LY",authDomain:"omnilabs-2dc80.firebaseapp.com",databaseURL:"https://omnilabs-2dc80.firebaseio.com",projectId:"omnilabs-2dc80",storageBucket:"omnilabs-2dc80.appspot.com",messagingSenderId:"593871858219"},g=firebase.initializeApp(f,"Labs Firebase"),h=g.database(),j=6e4,k=60*j,l=24*k,m=7*l,J=b(),K=Prometheus(c);K.logon(J);var L=x(document.location.search),M=L.code,N=L.team;document.getElementById("give-feedback").addEventListener("click",a=>{vex.dialog.prompt({message:"Share your feedback here.",placeholder:"Your feedback.",callback:a=>{K.save({type:"TEAM_PAGES_FEEDBACK",feedback:a})}})}),M&&K.redeem(M,a=>{var b="";b+="<h2>"+a.title+"</h2>";b+="<p>"+a.description+"</p>";vex.dialog.alert({unsafeMessage:b})},a=>{vex.dialog.alert(a)},{silent:!0}),N?G(N):A()}();